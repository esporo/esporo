{% if page.comments %}
  <section id="comments">
    <h2>Comentários</h2>
    <p>Faça parte da comunidade! <a href="https://forum.esporo.net">Participe do Fórum Esporo</a> para deixar um comentário e conversar com outros aliens.</p>
    
    {% if page.discussion_url %}
      <div class="loading" id="loading">Carregando discussão...</div>
      <iframe
        id="forum-iframe"
        class="forum-iframe"
        style="height: 600px; display: none;"
        title="Discussão do fórum"
        src="{{ page.discussion_url | append: "/embed" }}"
      ></iframe>
    {% endif %}
    
    <script>
      const iframe = document.getElementById('forum-iframe');
      const loading = document.getElementById('loading');
      
      // Escuta mensagens do iframe
      window.addEventListener('message', function(event) {
          // Verifica origem por segurança
          if (event.origin !== 'https://form.esporo.net') {
              return;
          }
          
          if (event.data.type === 'flarum-resize') {
              console.log('Nova altura recebida:', event.data.height);
              iframe.style.height = event.data.height + 'px';
          }
          
          if (event.data.type === 'flarum-loaded') {
              // Esconde loading e mostra iframe
              loading.style.display = 'none';
              iframe.style.display = 'block';
          }
      });
      
      // Timeout para caso não carregue
      setTimeout(() => {
          if (loading.style.display !== 'none') {
              loading.textContent = 'Erro ao carregar discussão';
          }
      }, 10000);
    </script>
{% endif  %}


